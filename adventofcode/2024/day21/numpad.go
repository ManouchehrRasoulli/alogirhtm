package day21

import (
	"log"
	"strings"
)

const (
	noValue = ' '
	confirm = 'A'
)

var (
	numPad = map[rune]map[rune][]rune{
		'7': {'7': {}, '8': {'>'}, '9': {'>', '>'},
			'4': {'v'}, '5': {'v', '>'}, '6': {'v', '>', '>'},
			'1': {'v', 'v'}, '2': {'v', 'v', '>'}, '3': {'v', 'v', '>', '>'},
			'0': {'>', 'v', 'v', 'v'}, 'A': {'>', '>', 'v', 'v', 'v'}},

		'8': {'7': {'<'}, '8': {}, '9': {'>'},
			'4': {'<', 'v'}, '5': {'v'}, '6': {'v', '>'},
			'1': {'<', 'v', 'v'}, '2': {'v', 'v'}, '3': {'v', 'v', '>'},
			'0': {'v', 'v', 'v'}, 'A': {'v', 'v', 'v', '>'}},

		'9': {'7': {'<', '<'}, '8': {'<'}, '9': {},
			'4': {'<', '<', 'v'}, '5': {'<', 'v'}, '6': {'v'},
			'1': {'<', '<', 'v', 'v'}, '2': {'<', 'v', 'v'}, '3': {'v', 'v'},
			'0': {'<', 'v', 'v', 'v'}, 'A': {'v', 'v', 'v'}},

		'4': {'7': {'^'}, '8': {'^', '>'}, '9': {'^', '>', '>'},
			'4': {}, '5': {'>'}, '6': {'>', '>'},
			'1': {'v'}, '2': {'v', '>'}, '3': {'v', '>', '>'},
			'0': {'>', 'v', 'v'}, 'A': {'>', '>', 'v', 'v'}},

		'5': {'7': {'<', '^'}, '8': {'^'}, '9': {'^', '>'},
			'4': {'<'}, '5': {}, '6': {'>'},
			'1': {'<', 'v'}, '2': {'v'}, '3': {'v', '>'},
			'0': {'v', 'v'}, 'A': {'v', 'v', '>'}},

		'6': {'7': {'<', '<', '^'}, '8': {'<', '^'}, '9': {'^'},
			'4': {'<', '<'}, '5': {'<'}, '6': {},
			'1': {'<', '<', 'v'}, '2': {'<', 'v'}, '3': {'v'},
			'0': {'<', 'v', 'v'}, 'A': {'v', 'v'}},

		'1': {'7': {'^', '^'}, '8': {'^', '^', '>'}, '9': {'^', '^', '>', '>'},
			'4': {'^'}, '5': {'^', '>'}, '6': {'^', '>', '>'},
			'1': {}, '2': {'>'}, '3': {'>', '>'},
			'0': {'>', 'v'}, 'A': {'>', '>', 'v'}},

		'2': {'7': {'<', '^', '^'}, '8': {'^', '^'}, '9': {'>', '^', '^'},
			'4': {'<', '^'}, '5': {'^'}, '6': {'^', '>'},
			'1': {'<'}, '2': {}, '3': {'>'},
			'0': {'v'}, 'A': {'v', '>'}},

		'3': {'7': {'<', '<', '^', '^'}, '8': {'<', '^', '^'}, '9': {'^', '^'},
			'4': {'^', '<', '<'}, '5': {'<', '^'}, '6': {'^'},
			'1': {'<', '<'}, '2': {'<'}, '3': {},
			'0': {'<', 'v'}, 'A': {'v'}},

		'0': {'7': {'^', '^', '^', '<'}, '8': {'^', '^', '^'}, '9': {'^', '^', '^', '>'},
			'4': {'^', '^', '<'}, '5': {'^', '^'}, '6': {'^', '^', '>'},
			'1': {'^', '<'}, '2': {'^'}, '3': {'^', '>'},
			'0': {}, 'A': {'>'}},

		'A': {'7': {'^', '^', '^', '<', '<'}, '8': {'<', '^', '^', '^'}, '9': {'^', '^', '^'},
			'4': {'^', '^', '<', '<'}, '5': {'^', '^', '<'}, '6': {'^', '^'},
			'1': {'^', '<', '<'}, '2': {'^', '<'}, '3': {'^'},
			'0': {'<'}, 'A': {}}}
)

type Numpad struct {
	nums string
}

func NewNumpad(nums string) *Numpad {
	nums = string(confirm) + nums // start from `A` and finish with `A`
	if !strings.HasSuffix(nums, string(confirm)) {
		nums += string(confirm)
	}

	return &Numpad{
		nums: nums,
	}
}

func (n *Numpad) NumsToDirections() []rune {
	var (
		path = make([]rune, 0)
	)

	log.Println("numpad compute directions ::", n.nums)

	for i := 1; i < len(n.nums); i++ {
		ac, bc := n.nums[i-1], n.nums[i]
		direction := numpadPathFromAtoB(rune(ac), rune(bc))
		path = append(path, direction...)
		path = append(path, confirm)
	}

	log.Println("numpad output ::", string(path))

	return path
}

func numpadPathFromAtoB(a rune, b rune) []rune {
	return numPad[a][b]
}
